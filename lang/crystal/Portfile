# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=8:sts=4
# $Id: Portfile 134857 2015-04-08 22:34:36Z ryandesign@macports.org $

PortSystem              1.0

name                    crystal
version                 0.14.2
license                 Apache-2
categories              lang
platforms               darwin
maintainers             gmail.com:israelchauca

description             A statically typed, compiled programming language with \
                        Ruby inspired syntax
long_description        Crystal is a programming language that resembles Ruby \
                        but compiles to native code and tries to be much more \
                        efficient, at the cost of disallowing certain dynamic \
                        aspects of Ruby.

homepage                http://crystal-lang.org/
master_sites            https://github.com/manastech/crystal/releases/download/${version}/
#github.tarball_from     releases
distname                ${name}-${version}-1-darwin-x86_64

checksums               rmd160  109e3fbb07e36a6cf2b651b148d3a60eca9f8930 \
                        sha256  c6c20d5ca3a2a0168461de8abfe85f9e6b255132698ea0109998d4ab68f9f6dd
checksum {}
depends_lib             port:pcre          \
                        port:libatomic_ops \
                        port:boehmgc       \
                        port:libyaml       \
                        port:libiconv      \
                        port:libevent

use_configure           no

build {}

destroot {
    set worksrcpath ${workpath}/${name}-${version}-1
    xinstall -d ${destroot}${prefix}/share/${name}/
    copy ${worksrcpath}/src ${destroot}${prefix}/share/${name}/src
    copy ${worksrcpath}/samples ${destroot}${prefix}/share/${name}/samples
    copy ${worksrcpath}/embedded/bin/crystal ${destroot}${prefix}/share/${name}
    reinplace "s|^\\(INSTALL_DIR=\\\"\\).*|\\1${prefix}/share/${name}/\"|" ${worksrcpath}/bin/crystal
    reinplace "s|^\\(export PATH\\)|#\\1|" ${worksrcpath}/bin/crystal
    reinplace "s|^\\(export LIBRARY_PATH.*\\)\$INSTALL_DIR/embedded/lib|\\1/usr/lib:${prefix}/lib|" ${worksrcpath}/bin/crystal
    reinplace "s|/embedded/bin||" ${worksrcpath}/bin/crystal
    copy ${worksrcpath}/bin/crystal ${destroot}${prefix}/bin/${name}
}
