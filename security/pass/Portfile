# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem            1.0

name                  pass
version               1.4.2
revision              0
categories            security
platforms             darwin
license               GPL-2+
maintainers           gmail.com:israelchauca

supported_archs       noarch
description           The standard unix password manager.
long_description      Password management should be simple and follow Unix    \
                      philosophy. With pass, each password lives inside of    \
                      a gpg encrypted file whose filename is the title of the \
                      website or resource that requires the password. These   \
                      encrypted files may be organized into meaningful folder \
                      hierarchies, copied from computer to computer, and, in  \
                      general, manipulated using standard command line file   \
                      management utilities.

homepage              http://zx2c4.com/projects/password-store/
master_sites          http://git.zx2c4.com/password-store/snapshot/
distname              password-store-${version}

checksums             rmd160 8f496a3c302ebe56bbbab002401e1a3efe1e1eaa \
                      sha256 a10a8016a3d6bb32891a9a4086ac0a049587db1a55c1ac3b431c66189bc1a302

use_xz                yes

depends_run           path:/usr/local/bin/gpg:gnupg2 \
                      bin:bash:bash  \
                      port:pwgen     \
                      port:tree      \
                      port:getopt

patch.pre_args        -p1
post-patch {
    reinplace "s|^GETOPT=.*|GETOPT=${prefix}/bin/getopt|" src/platform/darwin.sh
    reinplace "s|^SYSCONFDIR \\?= /etc|SYSCONFDIR ?= \$(PREFIX)/etc|" Makefile
    reinplace "s|@||" Makefile
}

variant zsh description {zsh completion support} {
    depends_run-append port:zsh
    patchfiles-append patch-zsh-completion.diff
}

variant fish description {fish completion support} {
    depends_run-append port:fish
    patchfiles-append patch-fish-completion.diff
}

use_configure         no

build {}

destroot.args-append  DESTDIR=${destroot} \
                      PREFIX=${prefix}
livecheck.type        regex
livecheck.url         http://zx2c4.com/projects/password-store/
livecheck.regex       The\\s+latest\\s+version\\s+is\\s+(\[0-9.\]+)\\.
