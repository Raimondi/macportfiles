# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem            1.0
name                  stockfish
version               5
revision              0
categories            games
platforms             darwin
license               GPL-3
maintainers           gmail.com:israelchauca
description           Powerful open source chess engine.
long_description      Stockfish is the strongest chess engine in the world. \
                      Period. You're getting the best-of-the-best in chess \
                      analysis.
homepage              http://stockfishchess.org/
distname              ${name}-${version}-src
master_sites          https://s3.amazonaws.com/${name}/
checksums             rmd160 fdd29256d279dc3ab586646f3c511d416cc38c1d \
                      sha256 071f5f9cc5c461e42462c3bc2f65ea96b8ca3de5048b927f82c609017c9392c2

use_zip               yes
fetch.ignore_sslcert  yes
use_configure         no

pre-build { set worksrcpath  ${worksrcpath}/src }
build.target          build
switch ${build_arch} {
    x86_64  { build.post_args ARCH=x86-64 }
    i386    { build.post_args ARCH=x86-32 }
    ppc     { build.post_args ARCH=ppc-32 }
    defaul  { build.post_args ARCH=x86-64 }
}
destroot.args         PREFIX=${destroot}${prefix}
destroot {
    set sfdir ${destroot}${prefix}/etc/${name}
    xinstall -d ${sfdir}
    xinstall ${worksrcpath}/stockfish ${sfdir}
    xinstall ${workpath}/${distname}/polyglot.ini ${sfdir}
    if { [file exists ${workpath}/Book.bin] } {
        xinstall -m 0644 ${workpath}/Book.bin ${sfdir}
    }
}

variant book description {install the Stockfish opening book.} {
    distfiles         ${distname}${extract.suffix}:src \
                      stockfish-231-book.zip:contrib
    master_sites-append http://cl.ly/3x333m0G173F/download/
    set checksums "${distname}${extract.suffix} ${checksums}"
    append checksums " stockfish-231-book.zip"
    append checksums " rmd160 845fe97d5bf647e707185181b8e44875adaa8e89"
    append checksums " sha256 07ee06bcd3fe1c5e0d90a2d0aede8bac2dd31d52fb4e1c9bc477bb5a8939e414"
}

variant x86_64_modern conflicts x86_32 x86_64 ppc_64 ppc_32 description {x86 64 bit with popcnt support.} {
    build.post_args ARCH=x86-64-modern
}
variant x86_64 conflicts x86_32 x86_64_modern ppc_64 ppc_32 description {x86 64 bit.} {
    build.post_args ARCH=x86-64
}
variant x86_32 conflicts x86_64 x86_64_modern ppc_64 ppc_32 description {x86 32 bit.} {
    build.post_args ARCH=x86-32
}
variant ppc_64 conflicts x86_32 x86_64 x86_64_modern ppc_32 description {PowerPC 64 bit.} {
    build.post_args ARCH=ppc-64
}
variant ppc_32 conflicts x86_32 x86_64 x86_64_modern ppc_64 description {PowerPC 32 bit.} {
    build.post_args ARCH=ppc-32
}
variant gcc conflicts clang description {Compile with gcc.} {
    build.post_args-append  COMP=gcc
}
variant clang conflicts gcc description {Compile with clang.} {
    build.post_args-append  COMP=clang
}
livecheck.type        regex
livecheck.url         https://github.com/official-stockfish/Stockfish/releases
livecheck.regex       sf_(\[0-9.\])"
